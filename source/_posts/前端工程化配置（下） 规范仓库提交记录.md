---
title: å‰ç«¯å·¥ç¨‹åŒ–é…ç½®(ä¸‹) è§„èŒƒä»“åº“æäº¤è®°å½• commitlint + commitizen + cz-git +  é…ç½®
date: 2022-10-26
updated: 2022-10-28 12:40
categories: [å‰ç«¯å·¥ç¨‹åŒ–]
tags: [git, commitlint, commitizen, cz-git, husky]
cover: https://cdn.xiangshu233.cn/post/banner/wallhaven-73kp79.jpg
---



## å‰è¨€

- éšç€å¤šäººå¼€å‘å›¢é˜Ÿæ¨è¿›ç€å‰ç«¯å·¥ç¨‹åŒ–çš„ä¸æ–­å‘å±•ï¼Œå›¢é˜Ÿè§„èŒƒä¸é¡¹ç›®ç³»ç»ŸåŒ–é…å¥—å·¥å…·é“¾æ¡ä¹Ÿåœ¨ä¸æ–­è¯ç”Ÿã€‚
- ä» `lerna` æˆ–åˆ°æœ€è¿‘å…´èµ·çš„ `pnpm` ç®¡ç† `monoreo workspace`ã€‚
- `eslint` é…åˆ `pretter` ç¡®ä¿å›¢é˜Ÿä»£ç æ ¼å¼ç»Ÿä¸€æ€§ã€‚
- `commitizen` é…åˆ `commitlint` ä¸ `lint-staged` ä¸ `husky` ä¹‹é—´çš„é…åˆï¼ŒæŠŠå…³æœ€åæäº¤ä»£ç è´¨é‡ä¸ commit ä¿¡æ¯è§„èŒƒã€‚
- å†åˆ°åˆ©ç”¨ `circleci`, `github action` æˆ– `gitee go` è¿›è¡ŒCI/CD(æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²)ã€‚

## æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ commitlint

æ‰§è¡Œ `git commit -m 'xxx'` æ—¶ï¼Œç”¨æ¥æ£€æŸ¥ `'xxx'` æ˜¯å¦æ»¡è¶³å›ºå®šæ ¼å¼çš„å·¥å…·ã€‚
ä¸ºä»€ä¹ˆä½¿ç”¨ `commitlint`ï¼šå›¢é˜Ÿä¸­è§„èŒƒäº† `commit` è§„èŒƒå¯ä»¥æ›´æ¸…æ™°çš„æŸ¥çœ‹æ¯ä¸€æ¬¡ä»£ç æäº¤è®°å½•ï¼Œè¿˜å¯ä»¥æ ¹æ®è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œè‡ªåŠ¨ç”Ÿæˆ `changeLog` æ–‡ä»¶ã€‚

### ä»€ä¹ˆæ˜¯ commitizen

 åŸºäº Node.js çš„ `git commit` å‘½ä»¤è¡Œå·¥å…·ï¼Œè¾…åŠ©ç”Ÿæˆæ ‡å‡†åŒ–è§„èŒƒåŒ–çš„ `commit message`ï¼Œæ˜¯ä¸€ä¸ªå¹³å°ï¼Œå…·ä½“èŒèƒ½äº¤ç»™é€‚é…å™¨ã€‚

### ä»€ä¹ˆæ˜¯ adapter(é€‚é…å™¨)

æ›´æ¢ `commitizen` å‘½ä»¤è¡Œå·¥å…·çš„**äº¤äº’æ–¹å¼**æ’ä»¶ã€‚åƒ `cz-emoji`ã€`cz-emoji-chinese`ã€`cz-conventional-changelog`ã€`cz-customizable`ï¼Œè¿™äº›éƒ½æ˜¯é€‚é…å™¨ï¼Œè‡³äºé€‰æ‹©å“ªä¸ªï¼Œçœ‹ä¸ªäººå–œå¥½é€‰æ‹©ã€‚

## å¼€å§‹

æœ¬æ–‡ä½¿ç”¨ `cz-git` æ¥ä½œä¸ºé€‚é…å™¨ï¼Œç†ç”±è¯·çœ‹ä½œè€…åšå®¢ï¼š[cz-git å‹å¥½å‹ commitizen çš„é€‚é…å™¨](https://blog.qbb.sh/post/2022/02/27/cz-git/)

### å®‰è£… commitizen

{% note color:green TIP

[å…¨å±€å®‰è£…](https://cz-git.qbb.sh/zh/guide/#å…¨å±€ä½¿ç”¨) `commitizen`ï¼Œå¦‚æ­¤ä¸€æ¥å¯ä»¥å¿«é€Ÿä½¿ç”¨ `cz` æˆ– `git cz` å‘½ä»¤è¿›è¡Œå¯åŠ¨ã€‚

```bash
npm install -g commitizen
```

%}

### åœ¨é¡¹ç›®ä¸­ä½¿ç”¨

### å®‰è£… cz-git

1. å®‰è£… `cz-git`ã€‚

```bash
pnpm install -D cz-git
```

2. `package.json` æ·»åŠ  **config** å­—æ®µï¼Œä¸º `commitizen` æŒ‡å®š `cz-git` é€‚é…å™¨

```json
// package.json
{
  "config": {
    "commitizen": {
      "path": "node_modules/cz-git"
    }
  }
}
```

### é…ç½® commitlint

1. é…ç½® `commitlint`

å®‰è£… `@commitlint/config-conventional` `@commitlint/cli`

`@commitlint/cli`Â æ˜¯ `commitlint` æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®‰è£…åä¼šå°† `cli` è„šæœ¬æ”¾ç½®åœ¨ `./node_modules/.bin/` ç›®å½•ä¸‹ã€‚
`@commitlint/config-conventional`Â æ˜¯ç¤¾åŒºä¸­ä¸€äº›å…±äº«çš„é…ç½®ï¼Œæ˜¯æ ¹æ® Angular æäº¤è§„èŒƒé¢„å®šä¹‰çš„è§„åˆ™åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•è¿™äº›é…ç½®ï¼Œä¹Ÿå¯ä»¥ä¸å®‰è£…è¿™ä¸ªåŒ…è‡ªå®šä¹‰é…ç½®ï¼Œ`commitlint` æ¨èæˆ‘ä»¬ä½¿ç”¨ `@commitlint/config-conventional` é…ç½®å»å†™ `commit`


```bash
pnpm install -D @commitlint/cli @commitlint/config-conventional
```

2. åˆ›å»º `commitlint.config.js` æ–‡ä»¶

å®‰è£…å®Œæˆä¹‹åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º commitlint.config.js æ–‡ä»¶ï¼Œæ¥é…ç½® `lint` è§„åˆ™ï¼š

`cz-git` æœ‰å¤šç§æ¨¡æ¿ï¼Œä¾‹å¦‚: ([â‡’ é…ç½®æ¨¡æ¿](https://cz-git.qbb.sh/zh/config/))ï¼Œè¿™é‡Œä½¿ç”¨ ä¸­è‹±å¯¹ç…§ + Emoji æ¨¡æ¿ï¼Œè™½ç„¶å®˜æ–¹å¹¶ä¸æ¨èè¿™ä¹ˆå¹²ğŸ˜†

```js
// commitlint.config.js
const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');

const scopes = fs
  .readdirSync(path.resolve(__dirname, 'src'), { withFileTypes: true })
  .filter((dirent) => dirent.isDirectory())
  .map((dirent) => dirent.name.replace(/s$/, ''));

// precomputed scope
const scopeComplete = execSync('git status --porcelain || true')
  .toString()
  .trim()
  .split('\n')
  .find((r) => ~r.indexOf('M  src'))
  ?.replace(/(\/)/g, '%%')
  ?.match(/src%%((\w|-)*)/)?.[1]
  ?.replace(/s$/, '');

/** @type {import('cz-git').UserConfig} */
module.exports = {
  ignores: [(commit) => commit.includes('init')],
  extends: ['@commitlint/config-conventional'],
  rules: {
    'body-leading-blank': [2, 'always'],
    'footer-leading-blank': [1, 'always'],
    'header-max-length': [2, 'always', 108],
    'subject-empty': [2, 'never'],
    'type-empty': [2, 'never'],
    'subject-case': [0],
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'perf',
        'style',
        'docs',
        'test',
        'refactor',
        'build',
        'ci',
        'chore',
        'revert',
        'wip',
        'workflow',
        'types',
        'release',
      ],
    ],
  },
  prompt: {
    /** @use `yarn commit :f` */
    alias: {
      f: 'docs: fix typos',
      r: 'docs: update README',
      s: 'style: update code format',
      b: 'build: bump dependencies',
      c: 'chore: update config',
    },
    customScopesAlign: !scopeComplete ? 'top' : 'bottom',
    defaultScope: scopeComplete,
    scopes: [...scopes, 'mock'],
    allowEmptyIssuePrefixs: true,
    allowCustomIssuePrefixs: true,
    messages: {
      type: 'é€‰æ‹©ä½ è¦æäº¤çš„ç±»å‹ :',
      scope: 'é€‰æ‹©ä¸€ä¸ªæäº¤èŒƒå›´ï¼ˆå¯é€‰ï¼‰:',
      customScope: 'è¯·è¾“å…¥è‡ªå®šä¹‰çš„æäº¤èŒƒå›´ :',
      subject: 'å¡«å†™ç®€çŸ­ç²¾ç‚¼çš„å˜æ›´æè¿° :\n',
      body: 'å¡«å†™æ›´åŠ è¯¦ç»†çš„å˜æ›´æè¿°ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ "|" æ¢è¡Œ :\n',
      breaking: 'åˆ—ä¸¾éå…¼å®¹æ€§é‡å¤§çš„å˜æ›´ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ "|" æ¢è¡Œ :\n',
      footerPrefixsSelect: 'é€‰æ‹©å…³è”issueå‰ç¼€ï¼ˆå¯é€‰ï¼‰:',
      customFooterPrefixs: 'è¾“å…¥è‡ªå®šä¹‰issueå‰ç¼€ :',
      footer: 'åˆ—ä¸¾å…³è”issue (å¯é€‰) ä¾‹å¦‚: #31, #I3244 :\n',
      confirmCommit: 'æ˜¯å¦æäº¤æˆ–ä¿®æ”¹commit ?',
    },
    types: [
      { value: 'feat', name: 'feat:      âœ¨ æ–°å¢åŠŸèƒ½ | A new feature', emoji: ':sparkles:' },
      { value: 'fix', name: 'fix:       ğŸ› ä¿®å¤ç¼ºé™· | A bug fix', emoji: ':bug:' },
      {
        value: 'docs',
        name: 'docs:      ğŸ“ æ–‡æ¡£æ›´æ–° | Documentation only changes',
        emoji: ':memo:',
      },
      {
        value: 'style',
        name: 'style:     ğŸ’„ ä»£ç æ ¼å¼ | Changes that do not affect the meaning of the code',
        emoji: ':lipstick:',
      },
      {
        value: 'refactor',
        name: 'refactor:  â™»ï¸  ä»£ç é‡æ„ | A code change that neither fixes a bug nor adds a feature',
        emoji: ':recycle:',
      },
      {
        value: 'perf',
        name: 'perf:      âš¡ï¸ æ€§èƒ½æå‡ | A code change that improves performance',
        emoji: ':zap:',
      },
      {
        value: 'test',
        name: 'test:      âœ… æµ‹è¯•ç›¸å…³ | Adding missing tests or correcting existing tests',
        emoji: ':white_check_mark:',
      },
      {
        value: 'build',
        name: 'build:     ğŸ“¦ï¸ æ„å»ºç›¸å…³ | Changes that affect the build system or external dependencies',
        emoji: ':package:',
      },
      {
        value: 'ci',
        name: 'ci:        ğŸ¡ æŒç»­é›†æˆ | Changes to our CI configuration files and scripts',
        emoji: ':ferris_wheel:',
      },
      { value: 'revert', name: 'revert:    ğŸ”¨ å›é€€ä»£ç  | Revert to a commit', emoji: ':hammer:' },
      {
        value: 'chore',
        name: 'chore:     âªï¸ å…¶ä»–ä¿®æ”¹ | Other changes that do not modify src or test files',
        emoji: ':rewind:',
      },
    ],
    useEmoji: true,
    emojiAlign: 'center',
    themeColorCode: '',
    allowCustomScopes: true,
    allowEmptyScopes: true,
    customScopesAlias: 'custom',
    emptyScopesAlias: 'empty',
    upperCaseSubject: false,
    markBreakingChangeMode: false,
    allowBreakingChanges: ['feat', 'fix'],
    breaklineNumber: 100,
    breaklineChar: '|',
    skipQuestions: [],
    issuePrefixs: [
      // å¦‚æœä½¿ç”¨ gitee ä½œä¸ºå¼€å‘ç®¡ç†
      { value: 'link', name: 'link:     é“¾æ¥ ISSUES è¿›è¡Œä¸­' },
      { value: 'closed', name: 'closed:   æ ‡è®° ISSUES å·²å®Œæˆ' },
    ],
    customIssuePrefixsAlign: 'top',
    emptyIssuePrefixsAlias: 'skip',
    customIssuePrefixsAlias: 'custom',
    confirmColorize: true,
    maxHeaderLength: Infinity,
    maxSubjectLength: Infinity,
    minSubjectLength: 0,
    scopeOverrides: undefined,
    defaultBody: '',
    defaultIssues: '',
    defaultSubject: '',
  },
};
```

### å®‰è£… husky

åœ¨[å‰ç«¯å·¥ç¨‹åŒ–é…ç½®ï¼ˆä¸Šï¼‰æ„å»ºä»£ç æ£€æŸ¥å·¥ä½œæµ](../å‰ç«¯å·¥ç¨‹åŒ–é…ç½®ï¼ˆä¸Šï¼‰%20æ„å»ºä»£ç æ£€æŸ¥å·¥ä½œæµ/)ä¸­å·²ç»å®‰è£… `husky`ï¼Œè¿™é‡Œç›´æ¥æ·»åŠ  `commit hook` é’©å­

```bash
pnpx husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'
```

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®å¥½äº† `commit hook`ï¼Œåœ¨ `commit` é˜¶æ®µå°±ä¼šå…ˆæ‰§è¡Œ `.husky/commit-msg` ä¸‹é¢çš„å‘½ä»¤ï¼Œè¿™é‡Œçš„ `.husky/commit-msg` å‘½ä»¤æ˜¯å»æ‰§è¡Œ `commitlint`ï¼Œæ£€æŸ¥ `commit message` æ˜¯å¦ç¬¦åˆ `commitlint.config.js` æ–‡ä»¶ä¸‹çš„é…ç½®è§„åˆ™ï¼Œè¿™æ—¶ï¼Œå¦‚æœæœ‰äºº `commit` ä¸ç¬¦åˆè§„èŒƒçš„ `message` å°±ä¼šæç¤ºé”™è¯¯ï¼Œé€€å‡º `commit` æ“ä½œ

## æ“ä½œæ¼”ç¤º

{% image https://fastly.jsdelivr.net/gh/xiangshu233/blogAssets/2022/07/20221028135537.png %}

æ”¾å…¥æš‚å­˜åŒºï¼ˆ`git add .`ï¼‰ä»¥åï¼Œæ‰§è¡Œ `git cz` å¯åŠ¨ `cz-git` é€‚é…å™¨ï¼Œå®ƒä¼šè¯»å–ä½ çš„ `commitlint.config.js` é…ç½®ï¼Œç¡®è®¤æäº¤åä¼šå…ˆè§¦å‘ `pre-commit` hook æ‰§è¡Œ `lint-staged` æ£€æŸ¥æš‚å­˜åŒºçš„ä»£ç æ ¼å¼æ˜¯å¦è§„èŒƒå¹¶ä¿®æ”¹ï¼Œä¹‹åå†è§¦å‘ `commit-msg` hookã€‚

{% note color:yellow æ³¨æ„ å¦‚æœä½ ä½¿ç”¨åŸç”Ÿ `gitcommit -m 'xxx'` ä¼šè§¦å‘ `commit-msg` hookï¼Œä¼šç›´æ¥æ‰“æ–­æäº¤ï¼Œå› ä¸ºä¸ç¬¦åˆ `commitlint` è§„èŒƒã€‚ %}

æœ€å `git push` å³å¯ã€‚

{% image https://fastly.jsdelivr.net/gh/xiangshu233/blogAssets/2022/07/20221028140413.png %}

æœ€åï¼ŒæŸ¥çœ‹ `github` ï¼Œå‘ç°å·²ç»æŒ‰ç…§ `commitlint` è§„èŒƒæäº¤ä¸Šå»äº†ã€‚

{% image https://fastly.jsdelivr.net/gh/xiangshu233/blogAssets/2022/07/20221028135539.png %}



## å‚è€ƒèµ„æ–™

[å‰ç«¯ Git-Hooks å·¥ç¨‹åŒ–å®è·µ](https://segmentfault.com/a/1190000042044415)

[ç»„ä»¶åº“ä»£ç è§„èŒƒhusky+lint-staged+Eslint+Prettier+Stylelint](https://juejin.cn/post/7136009620979449893)

[åˆ©ç”¨husky,cz-git,@commitlint/cliè§„èŒƒcommit message](https://zhuanlan.zhihu.com/p/542568185)

[ä½¿ç”¨commitizenæ¥è§„èŒƒä»“åº“çš„æäº¤è®°å½•](https://neilning-xc.github.io/2021/12/12/ckxj3g81e000p9ynthi2f2uqb/)

[husky æ–‡æ¡£](https://typicode.github.io/husky/)

[cz-git é…ç½®æ¨¡æ¿](https://cz-git.qbb.sh/zh/config/)

[vue-vben-admin çš„ commitlint.config.js é…ç½®](https://github.com/vbenjs/vue-vben-admin/blob/main/commitlint.config.js)

[cz-git å‹å¥½å‹ commitizen çš„é€‚é…å™¨](https://blog.qbb.sh/post/2022/02/27/cz-git/)

[cz-git æ–‡æ¡£](https://cz-git.qbb.sh/zh/)
